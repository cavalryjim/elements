<p>
  <%= f.label :name %><br />
  <%= f.text_field :name %>
</p>
<p>
  <%= f.label :parent %><br />
  <%= f.select :parent_id, options_for_select(Element, @element) {|i| "#{'-' * i.ancestry_depth.to_i} #{i.name}" } %>
</p>
<p>
  <%= f.label :position %><br />
  <%= f.text_field :position %>
</p>
<% unless f.object.nil? or f.object.attachable.nil? %>
<p>
  <% f.fields_for :attachable, f.object.attachable do |builder|  %>
    <%= render "#{f.object.attachable.class.to_s.tableize}/form", :f => builder %>
  <% end %>
</p>
<% else %>
<p>
  <%= f.label :attachable %><br />
  <%= f.select :attachable, Element::COMPONENTS,
    { :prompt => "Select one:" },
    { :onchange => remote_function(
        :url => { :action => :new_component },
        :with => "'type='+this.value",
        :update => "component")
    } %>
  <%#= f.text_field :type %>
</p>
<div id="component"></div>
<% end %>
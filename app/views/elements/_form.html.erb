<div id="element_form_tabs">
  <ul>
    <li><a href="#element_tab1">Element</a></li>
    <li><a href="#element_tab2"><%= f.object.new_record? ? "Type" : f.object.attachable.class %></a></li>
  </ul>
  <div id="element_tab1">
    <fieldset id="element">
    <%= f.label :element %><br />
    <p>
      <%= f.label :name %><br />
      <%= f.text_field :name %>
    </p>
    <!--p>
      <%#= f.label :parent %><br />
      <%#= f.select :parent_id, options_for_select(Element, @element) {|i| "#{'-' * i.ancestry_depth.to_i} #{i.name} #{"(#{i.attachable.class})" if i.has_attachable?}" } %>
    </p-->
    <p>
      <%= f.label :tag_list %><br />
      <%= f.text_field :tag_list %>
    </p>
  </div>
  <div id="element_tab2">
    <%= f.select "attachable_type", Element::COMPONENTS,
      { :prompt => "Select one:" } if f.object.new_record? %>
    <div id="component">
    <% if !f.object.nil? and f.object.has_attachable? %>
      <% f.fields_for :attachable, f.object.attachable do |builder|  %>
        <%= builder.hidden_field :attachable_type, :value => builder.object.class.to_s %>
        <%= render "#{f.object.attachable.class.to_s.tableize}/form", :f => builder %>
      <% end %>
    <% end %>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function() {
    $("#element_form_tabs").tabs({
      cookie: {
				// store cookie for a day, without, it would be a session cookie
				expires: 1
			}
    });
    $('#element_attachable_type').change(function() {
      var type = $(this).val();
      $.post(
        '<%= new_component_elements_url %>',
        {attachable_type:type},
        function (data){$("#component").html(data)}
      )
    });
  });
</script>
